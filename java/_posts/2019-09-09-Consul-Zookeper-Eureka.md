# Consul / Zookeper / Eureka


## 区别

| 特点 | Consul | Eureka | Zookeeper |
----- | ------ | -------- | ---------
开发语言 |  Go    | Java Servlet | 
多数据中心 | 支持 | — | —
kv存储服务	| 支持 | — | 支持
一致性 | raft | — | paxos
CAP | CA | AP | CP 
使用接口(多语言能力) | 支持http和dns | http（sidecar）| 客户端
Spring Cloud集成 | 已支持 | 已支持 | 已支持

## CAP

CAP原理中，有三个要素：

* 一致性(***C***onsistency)
* 可用性(***A***vailability)
* 分区容忍性(***P***artition tolerance)

***CAP***原理指的是，这三个要素最多只能同时实现两点，不可能三者兼顾。因此在进行分布式架构设计时，必须做出取舍。

而对于分布式数据系统，分区容忍性是基本要求，否则就失去了价值。因此设计分布式数据系统，就是在一致性和可用性之间取一个平衡。

对于大多数web应用，其实并不需要强一致性，因此牺牲一致性而换取高可用性，是目前多数分布式数据库产品的方向。

当然，牺牲一致性，并不是完全不管数据的一致性，否则数据是混乱的，那么系统可用性再高分布式再好也没有了价值。牺牲一致性，只是不再要求关系型数据库中的强一致性，而是只要系统能达到***最终一致性***即可，考虑到客户体验，这个最终一致的时间窗口，要尽可能的对用户透明，也就是需要保障“用户感知到的一致性”。通常是通过数据的多份异步复制来实现系统的高可用和数据的最终一致性的，“用户感知到的一致性”的时间窗口则取决于数据复制到一致状态的时间。

### 最终一致性 Eventually Consistent

对于关系型数据库，要求更新过的数据能被后续的访问都能看到，这是***强一致性***。如果能容忍后续的部分或者全部访问不到，则是***弱一致性***。如果经过一段时间后要求能访问到更新后的数据，则是***最终一致性***。

## References

* [使用Consul做服务发现的若干姿势][使用Consul做服务发现的若干姿势]
* [理解数据库的事务，ACID，CAP和一致性][理解数据库的事务，ACID，CAP和一致性]

[使用Consul做服务发现的若干姿势]: http://blog.didispace.com/consul-service-discovery-exp/ "使用Consul做服务发现的若干姿势"
[理解数据库的事务，ACID，CAP和一致性]: https://www.jianshu.com/p/2c30d1fe5c4e "理解数据库的事务，ACID，CAP和一致性"